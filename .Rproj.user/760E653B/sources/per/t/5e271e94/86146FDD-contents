
library(odbc)       #R library for Open Database Connectivity, used to connect to databases


#set up the connection to the SMRA database 
con <- dbConnect(odbc(), dsn = "SMRA", uid = .rs.askForPassword("SMRA Username:"), 
                 pwd = .rs.askForPassword("SMRA Password:"))

#list all the views under the analysis scheme
odbcListObjects(con, schema="ANALYSIS")

#count the number of rows in in a view
dbGetQuery(con, "SELECT COUNT(*) FROM ANALYSIS.SMR00_PI")

#Preview the column names of a view
odbcPreviewObject(con, table="ANALYSIS.SMR00_PI", rowLimit=0)

#extract the first 10 rows from a view
dbGetQuery(con, "SELECT * FROM ANALYSIS.SMR00_PI WHERE Rownum <= 10")

#extract specific variables from a view
dbGetQuery(con, "SELECT DATE_REFERRAL_RECEIVED, REFERRAL_SOURCE
           FROM ANALYSIS.SMR00_PI WHERE Rownum <= 10")

#if you remove the WHERE constraint you will extract all the rows & you can store this in a df for example
#because of the ammount of data this can take a while to run

df <- dbGetQuery(con, "SELECT DATE_REFERRAL_RECEIVED, REFERRAL_SOURCE
           FROM ANALYSIS.SMR00_PI ")

#when you are done running your queries you can close the connection:
dbDisconnect(con)

#checking the status of a connection
dbIsValid(con)     #this returns TRUE if the connection is open, FALSE if it is closed